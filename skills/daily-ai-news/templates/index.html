<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }} - {{ date_display }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <!-- é¡µå¤´ -->
        <header>
            <div class="header-left">
                <h1>{{ title }}</h1>
                <div class="date">{{ date_display }}</div>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">åˆ‡æ¢ä¸»é¢˜</button>
        </header>

        <!-- ç»Ÿè®¡å¡ç‰‡ -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="label">ä»Šæ—¥åšæ–‡</div>
                <div class="value">{{ stats.total }}</div>
            </div>
            <div class="stat-card">
                <div class="label">å¹³å‡çƒ­åº¦</div>
                <div class="value">{{ "%.1f"|format(stats.avg_hot_score) }}</div>
            </div>
            {% if stats.category_distribution %}
                <div class="stat-card">
                    <div class="label">ä¸»è¦åˆ†ç±»</div>
                    <div class="value" style="font-size: 1rem;">
                        {% for cat, count in stats.category_distribution.items() %}
                            <span style="display: inline-block; margin: 2px 5px;">
                                {{ cat }}: {{ count }}
                            </span>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </div>

        <!-- åˆ†ç±»ç­›é€‰ -->
        <div class="category-filter">
            <span class="category-tag active" onclick="filterCategory('å…¨éƒ¨')">å…¨éƒ¨</span>
            {% for category in categories %}
                <span class="category-tag" onclick="filterCategory('{{ category }}')">{{ category }}</span>
            {% endfor %}
        </div>

        <!-- åšæ–‡åˆ—è¡¨ -->
        <div class="tweet-list">
            {% for tweet in tweets %}
            <div class="tweet-card" data-category="{{ tweet.category }}">
                <div class="tweet-header">
                    {% if tweet.author.avatar %}
                    <img src="{{ tweet.author.avatar }}" alt="" class="tweet-avatar">
                    {% else %}
                    <div class="tweet-avatar">{{ tweet.author.username[0]|upper }}</div>
                    {% endif %}
                    <div class="tweet-author">
                        <div class="name">{{ tweet.author.name }}</div>
                        <div class="username">@{{ tweet.author.username }}</div>
                    </div>
                    <span class="tweet-category">{{ tweet.category }}</span>
                </div>

                <div class="tweet-content">
                    {{ tweet.text }}
                </div>

                {% if tweet.tags %}
                <div class="tweet-tags">
                    {% for tag in tweet.tags %}
                    <span class="tweet-tag">#{{ tag }}</span>
                    {% endfor %}
                </div>
                {% endif %}

                <div class="tweet-metrics">
                    <span class="metric">â¤ï¸ {{ tweet.metrics.like_count|format_number }}</span>
                    <span class="metric">ğŸ”„ {{ tweet.metrics.retweet_count|format_number }}</span>
                    <span class="metric">ğŸ’¬ {{ tweet.metrics.reply_count|format_number }}</span>
                    <span class="metric">ğŸ”¥ {{ tweet.hot_score|round(1) }}</span>
                    <a href="{{ tweet.url }}" class="tweet-link" target="_blank">æŸ¥çœ‹åŸæ–‡ â†’</a>
                </div>
            </div>
            {% endfor %}
        </div>

        <!-- é¡µè„š -->
        <footer>
            <p>ç”Ÿæˆæ—¶é—´: {{ now }}</p>
            <p>æ•°æ®æ¥æº: X (Twitter) | æ¯æ—¥ AI é€Ÿé€’</p>
        </footer>
    </div>

    <script>
        // ä¸»é¢˜åˆ‡æ¢
        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            const isDark = document.body.classList.contains('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
        }

        // åŠ è½½ä¿å­˜çš„ä¸»é¢˜
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
        }

        // åˆ†ç±»ç­›é€‰
        function filterCategory(category) {
            const cards = document.querySelectorAll('.tweet-card');
            const tags = document.querySelectorAll('.category-tag');

            tags.forEach(tag => {
                tag.classList.remove('active');
                if (tag.textContent === category) {
                    tag.classList.add('active');
                }
            });

            cards.forEach(card => {
                if (category === 'å…¨éƒ¨' || card.dataset.category === category) {
                    card.style.display = 'block';
                } else {
                    card.style.display = 'none';
                }
            });
        }
    </script>
</body>
</html>
